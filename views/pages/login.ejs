<!-- views/pages/index.ejs -->
<!DOCTYPE html>
<html lang="en" style="height: 100vh">

<head>
    <% include ../partials/mdhead %>
</head>

<body style="background-color: rgb(230, 230, 230);">
    <header>
    </header>
    <% include ../partials/navbar %>
    <main class="flex-center flex-column animated fadeIn mb-4">
        <!-- Default form login -->
        <form class="text-center border border-light p-5" style="background-color: white;">

            <p class="h4 mb-4">Sign in</p>

            <!-- Email -->
            <input type="email" name="defaultLoginFormEmail" id="defaultLoginFormEmail" class="form-control mb-4"
                placeholder="E-mail">

            <!-- Password -->
            <input type="password" name="defaultLoginFormPassword" id="defaultLoginFormPassword" class="form-control mb-4"
                placeholder="Password">

            <p class="red-text" id="errorSpace"></p> <br />
            <div class="d-flex justify-content-around">
                <div>
                    <!-- Remember me -->
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="defaultLoginFormRemember">
                        <label class="custom-control-label" for="defaultLoginFormRemember">Remember me</label>
                    </div>
                </div>
                <div class="pl-1">
                    <!-- Forgot password -->
                    <a href="">Forgot password?</a>
                </div>
            </div>

            <!-- Sign in button  type="submit" -->
            <a id="submitBtn" class="btn red white-text btn-block my-4 " id="signInBtn">Sign in</a>

            <!-- Register -->
            <p>Not a member?
                <a href="/signup">Register</a>
            </p>

            <hr>

            <a class="light-blue-text mx-2" href="/">
                Home Page
            </a>
        </form>
        <!-- Default form login -->

    </main>
    <% include ../partials/mdscripts %>
    <script>

        $(document).ready(function () {
            console.log("ready!");

            $("#submitBtn").click(function (event) {
                event.preventDefault();
                var _username = $('input#defaultLoginFormEmail').val();
                var _password = $('input#defaultLoginFormPassword').val();

                if (!_username || !_password) {
                    console.log("EMPYT");
                    $("p#errorSpace").html("Fill up the fields");
                    return;
                }
                $.ajax
                    ({
                        url: '/users',
                        data: {
                            email: _username
                        },
                        type: 'get',
                        success: function (data) {
                            console.log("GET Response", data);

                            if(!data || data.length == 0){
                                $("p#errorSpace").html("User does not exist");
                                return;
                            }

                            if(data[0].password != _password){
                                $("p#errorSpace").html("Password Incorrect");
                                return;
                            }
                            // Save data to sessionStorage
                            console.log("Saving User Local Session ",  data[0]);
                            sessionStorage.setItem('curentUser', JSON.stringify(data[0]) );

                            // Get saved data from sessionStorage
                            var currUser = sessionStorage.getItem('curentUser');
                            console.log("Retrieving from User Local Session ",  JSON.parse(currUser) );

                            // Remove saved data from sessionStorage
                            //sessionStorage.removeItem('key');

                            // Remove all saved data from sessionStorage
                            //sessionStorage.clear();
                            //var _username = document.getElementById('input#defaultLoginFormEmail').value ;

                        }
                    });
            });
        });



    </script>
</body>
<footer>
</footer>

</html>